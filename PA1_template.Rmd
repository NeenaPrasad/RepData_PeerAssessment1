---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---
```{r,include = FALSE}
if (!("ggplot2") %in% installed.packages()) install.packages("ggplot2")
library(ggplot2)
if (!("activity.csv" %in% dir())) unzip("activity.zip")
```
## Loading and preprocessing the data
```{r, echo = TRUE}

## reading the csv file into R and changing the date format
activity <- read.csv("activity.csv")
activity$date <- as.Date(activity$date, "%Y-%m-%d")


## Viewing the data structure
head(activity)
```


## What is mean total number of steps taken per day?
```{r, echo = TRUE}

## 1. Calculate the total number of steps per day
## aggregate to obtain the total steps per day
## ignoring missing values

dfActivity <- aggregate(x = list(totSteps = activity$steps), by = list(Date = activity$date), FUN = sum)

head(dfActivity, n = 20, na.rm = TRUE)

## 2. Histogram of total number of steps taken each day
## plotting the count of steps

ggplot(dfActivity, aes(x = dfActivity$Date, y = dfActivity$totSteps))+
        geom_histogram(stat = "identity")+ labs(title = "Total Steps over days",
        x ="Total Steps in a day", y = "Count")


##3.  Mean and median of total number of steps taken per day
## mean and median of total steps per day
mean(dfActivity$totSteps, na.rm = TRUE)
median(dfActivity$totSteps, na.rm = TRUE)
        
```


## What is the average daily activity pattern?
```{r, echo = TRUE}

## removing NA values and calculating average steps in an interval over days
dfMeanActivity <-  aggregate(x = list(meanSteps = activity$steps), by = list(interval = activity$interval), FUN = mean, na.rm = TRUE)

## 1. Make a time series plot of the 5 minute inteval and average number of steps taken 
## averaged across all days

ggplot(dfMeanActivity, aes(x=interval, y = meanSteps))+geom_line()+
        labs(title = "Mean Steps in 5 minute intervals", 
        x ="Time interval - 5 minute", y = "Mean steps")

## 2. Which 5-minute interval, on average across all the days in the dataset,contains the maximum number of steps?

dfMeanActivity[dfMeanActivity$meanSteps == max(dfMeanActivity$meanSteps),]

```



## Imputing missing values
```{r, echo = TRUE}
## Calculate and report the total number of missing values in the dataset

sum(is.na(activity$steps))

##2. Device a strategy for filling in all missing values in the dataset. THe strategy does not need to be sophosticated. For example, you could use the mean/median for that day, or the mean for that 5-minute interval,etc.

##3. Create a new datset that is equal to the original dataset but the missing data filled in



## Filling in the missing data with mean of the interval and creating a new dataset



fillActivity <- activity

## Function to substitute NA values in the dataset with mean values
evalNAval <- function(index){
        temp <- activity[index,]
        return(dfMeanActivity$meanSteps[temp$interval == dfMeanActivity$interval])     
}

## row numbers corresponding to NA values

id <- which(is.na(activity$steps))

## replacing the NA values with the mean values

fillActivity$steps[is.na(activity$steps)] <- sapply(id, evalNAval)


dfActivityFill <- aggregate(x = list(totSteps = fillActivity$steps), by = list(Date = fillActivity$date), FUN = sum)

## new dataset with substitute values
head(fillActivity, n = 20)
## aggregate data set
head(dfActivityFill, n = 20)

## 4. Make the histogram of total number of steps taken each day and Calculate and report mean and median total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? What is the impact of imputing missing data on the estimates of the total daily number of steps?

ggplot(dfActivityFill, aes(x = dfActivityFill$Date, y = dfActivityFill$totSteps))+
        geom_histogram(stat = "identity")+ labs(title = "Total Steps over days",
                                                x ="Total Steps in a day", y = "Count")


## mean and median of new dataset
mean(dfActivityFill$totSteps)
median(dfActivityFill$totSteps)

## mean and median of old dataset
mean(dfActivity$totSteps, na.rm = TRUE)
median(dfActivity$totSteps, na.rm = TRUE)

## The mean and median values have not changed much with the mean value data insertion


```


## Are there differences in activity patterns between weekdays and weekends?
```{r, echo = TRUE}
## 1. Create a new factor variable in the dataset with two levels -- "weekday" and "weekend" indicating whether a given date is a weekday or weekend day.


evalDay <- function(dateVal){
        if (weekdays(dateVal) %in% c("Sunday","Saturday")) {
                return(0)
        } 
        return(1)
}

fillActivity$dayOfWeek <- sapply(fillActivity$date, evalDay)
fillActivity$dayOfWeek <- factor(fillActivity$dayOfWeek, levels = c(1,0), 
                                 labels = c("weekday", "weekend"))

head(fillActivity,n=20)

## 2. Make a panel plot containing a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis).

dfWkActivity <- aggregate(list(meanSteps = fillActivity$steps), by =  list(interval = fillActivity$interval,dayOfWeek = fillActivity$dayOfWeek), FUN = mean)


ggplot(dfWkActivity, aes(x=interval, y = meanSteps, col = dayOfWeek))+geom_line()+
        labs(title = "Mean Steps in 5 minute intervals", 
             x ="Interval", y = "Number of steps")+
        facet_grid(dayOfWeek~.)
```



#### During weekdays there is increased activity around 8 to 10 interval, which subsides over the time till night. During weekends peak activity happens a little later than weekdays and is maintained around 50 steps till about 2000 at night. Night time steps are also shifted a little to the right compared to the weekdays.
